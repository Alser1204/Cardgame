<!DOCTYPE html>
<html lang="ja">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Arcaea ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- å·¦ä¸Šãƒ›ãƒãƒ¼å¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div class="menu">
    <div class="menu-button" onclick="toggleMenu()">â˜°</div>
    <div class="menu-content" id="menuContent">
      <!-- â–¼ åå‰è¨­å®š -->
      <div class="tab" onclick="toggleNameBox()">åå‰è¨­å®š</div>
      <div id="nameBox" class="hidden" style="display:flex; align-items:center; gap:4px;">
        <input type="text" id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›" style="width:120px;">
        <button id="setNameBtn">è¨­å®š</button>
      </div>

      <!-- â–¼ ãƒ«ãƒ¼ãƒ å‚åŠ  -->
      <div class="tab" onclick="toggleJoinBox()">ãƒ«ãƒ¼ãƒ å‚åŠ </div>
      <div id="joinBox" class="hidden" style="display:flex; align-items:center; gap:4px;">
        <input type="text" id="roomInput" placeholder="ãƒ«ãƒ¼ãƒ ID" style="width:120px;">
        <button id="joinBtn">å‚åŠ </button>
      </div>

      <div class="tab" onclick="showCardList(cardList)">ã‚«ãƒ¼ãƒ‰ä¸€è¦§</div>
      <!-- ã‚«ãƒ¼ãƒ‰ä¸€è¦§è¡¨ç¤ºç”¨ -->
      <div id="cardListContainer" class="hidden">
        <!-- æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ -->
        <input type="text" id="cardSearch" placeholder="æ¤œç´¢" style="width:100%; margin-bottom:8px;">
        <div id="cardNameList" style="display:flex; flex-direction:column; gap:4px;"></div>
        <div id="cardDetail" style="margin-top:20px;"></div>
      </div>
      <!-- ğŸ“œãƒ«ãƒ¼ãƒ«èª¬æ˜ãƒœã‚¿ãƒ³ -->
      <div class="tab" onclick="openRuleModal()">ãƒ«ãƒ¼ãƒ«èª¬æ˜</div>
      <div class="tab" onclick="alert('è¨­å®šäºˆå®šã ã‘ã©è¨­å®šã™ã‚‹ã“ã¨ã‚ã‚‹ã‹ï¼Ÿ');">è¨­å®š</div>
    </div>
  </div>

  <h1>Arcaea ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </h1>

  <div id="intro">
    <p>ã‚ˆã†ã“ãï¼<br>å·¦ä¸Šã® â˜° ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ã‹ã‚‰åå‰ã‚’è¨­å®šã—ã€ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã—ã¦ãã ã•ã„ã€‚</p>
  </div>


  <!--
  <div>
    åå‰: <input type="text" id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›">
    <button id="setNameBtn">è¨­å®š</button>
  </div>

  <div>
    ãƒ«ãƒ¼ãƒ ID: <input type="text" id="roomInput" placeholder="room1">
    <button id="joinBtn">å‚åŠ </button>
  </div>
  -->

  <div id="entered-room">
    <div id="mid-section">
      <div id="side-panel">
        <h3>å€‹äººãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
        <div id="messageWindow"></div>
        <div id="costDiv">
          <h3>ã‚³ã‚¹ãƒˆï¼š5/5</h3>
        </div>
        <div>
          <button id="endTurnBtn">ã‚¿ãƒ¼ãƒ³çµ‚äº†</button>
        </div>
      </div>
    </div>

    <div id="playedCardContainer"></div>

    <h3>æ‰‹æœ­</h3>
    <div id="hand"></div>

    <h3>HP</h3>
    <div id="hpDiv"></div>

    <h3>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
    <div id="messages"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>

    // åˆæœŸçŠ¶æ…‹ï¼šã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢éè¡¨ç¤º
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("entered-room").classList.add("hidden");
    });


    //ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¿ãƒ–
    let menuOpen = false;
    let cardOpen = false;

    function toggleMenu() {
      const menu = document.getElementById("menuContent");
      menuOpen = !menuOpen;

      if (menuOpen) {
        menu.classList.add("show");
      } else {
        menu.classList.remove("show");
      }
    }

    // --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†…ã‚¯ãƒªãƒƒã‚¯ã§ã¯å¤–ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ã‚’ç„¡åŠ¹åŒ– ---
    document.getElementById("menuContent").addEventListener("click", (e) => {
      e.stopPropagation();
    });

    // --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹å‡¦ç† ---
    /*document.addEventListener("click", (e) => {
      const menu = document.querySelector(".menu");
      if (!menu.contains(e.target)) {
        const menuContent = document.getElementById("menuContent");
        menuContent.classList.remove("show");
        menuOpen = false;
      }
    });*/

    let cardList = []; // JSONã‹ã‚‰èª­ã¿è¾¼ã‚€ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

    function showCardList(filteredCards = null, toggle = true) {
      const container = document.getElementById("cardListContainer");

      if (toggle) {
        cardOpen = !cardOpen;
      }

      if (cardOpen) {
        container.classList.remove("hidden");
      } else {
        container.classList.add("hidden");
      }

      const cardsToRender = filteredCards || cardList;
      const nameListDiv = document.getElementById("cardNameList");
      nameListDiv.innerHTML = "";

      cardsToRender.forEach(card => {
        const btn = document.createElement("cardListButton");
        btn.textContent = card.display_name || card.name;
        btn.style.textAlign = "left";
        btn.style.color = "black";

        const detailDiv = document.createElement("div");
        detailDiv.classList.add("card-detail");
        detailDiv.style.marginLeft = "20px";
        detailDiv.style.display = "none";

        btn.onclick = () => {
          if (detailDiv.style.display === "none") {
            let effect = "ãªã—";
            switch (card.effect) {
              case "multiTurn": effect = "ã‚¿ãƒ¼ãƒ³æŒç¶š"; break;
              case "skipNextTurn": effect = "ç›¸æ‰‹ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—"; break;
              case "drawCard": effect = "ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã"; break;
              case "swapHand": effect = "ç›¸æ‰‹ã¨ã‚«ãƒ¼ãƒ‰ã‚’äº¤æ›"; break;
              case "atkUp": effect = "ãƒ€ãƒ¡ãƒ¼ã‚¸é‡ä¸Šä¹—ã›" + "+" + card.damageBoost; break;
              case "atkMultiplier": effect = "æ”»æ’ƒåŠ›å€ç‡è£œæ­£" + "Ã—" + card.multiplier; break;
              case "shieldUp": effect = "ã‚·ãƒ¼ãƒ«ãƒ‰é‡ä¸Šä¹—ã›" + "+" + card.shieldBoost; break;
              case "shieldMultiplier": effect = "é˜²å¾¡åŠ›å€ç‡è£œæ­£" + "Ã—" + card.multiplier; break;
              case "shieldMultiplier": effect = "é˜²å¾¡åŠ›å€ç‡è£œæ­£" + "Ã—" + card.multiplier; break;
              case "avoidUp": effect = "å›é¿ç‡ã‚¢ãƒƒãƒ—" + "+" + card.avoid*100; break;
            }
            detailDiv.innerHTML = `
          <img src="images/${card.name}.jpg" alt="${card.name}" style="width:150px;">
          <p>åŠ¹æœ: ${effect || "ãªã—"}</p>
          <p>æŒç¶šã‚¿ãƒ¼ãƒ³æ•°: ${card.turns || "ãªã—"}</p>
          <p>æ”»æ’ƒ: ${card.damage || card.damagePerTurn || 0}, é˜²å¾¡: ${card.shield || card.shieldPerTurn || 0}, å›å¾©: ${card.heal || card.healPerTurn || 0}</p>
        `;
            detailDiv.style.display = "block";
          } else {
            detailDiv.style.display = "none";
          }
        };

        nameListDiv.appendChild(btn);
        nameListDiv.appendChild(detailDiv);
      });
    }


    // æ¤œç´¢
    document.getElementById("cardSearch").addEventListener("input", (e) => {
      const query = e.target.value.toLowerCase();
      if (!query) {
        showCardList(null, false);
        return;
      }
      const filteredCards = cardList.filter(card =>
        (card.display_name || card.name).toLowerCase().includes(query)
      );
      showCardList(filteredCards, false); // â†ã“ã“ã§falseæŒ‡å®šï¼
    });


    // åˆå›ã‚«ãƒ¼ãƒ‰èª­ã¿è¾¼ã¿
    fetch("cards.json")
      .then(res => res.json())
      .then(cards => cardList = cards)
      .catch(err => console.error("ã‚«ãƒ¼ãƒ‰ä¸€è¦§èª­ã¿è¾¼ã¿å¤±æ•—:", err));

    fetch("dgacha.json")
      .then(res => res.json())
      .then(cards => dgachaCardList = cards)
      .catch(err => console.error("dgachaã‚«ãƒ¼ãƒ‰ä¸€è¦§èª­ã¿è¾¼ã¿å¤±æ•—:", err));

    //ãƒ«ãƒ¼ãƒ«èª¬æ˜
    function openRuleModal() {
      document.getElementById("ruleModal").classList.remove("hidden");
    }

    function closeRuleModal() {
      document.getElementById("ruleModal").classList.add("hidden");
    }

    // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚é–‰ã˜ã‚‹
    window.addEventListener("click", (e) => {
      const modal = document.getElementById("ruleModal");
      if (e.target === modal) {
        closeRuleModal();
      }
    });

    const socket = io();
    let myRoomId = null;

    // è¦ç´ 
    const handDiv = document.getElementById("hand");
    const messagesDiv = document.getElementById("messages");
    const messageWindowDiv = document.getElementById("messageWindow");
    const hpDiv = document.getElementById("hpDiv");

    function toggleNameBox() {
      const box = document.getElementById("nameBox");
      box.classList.toggle("hidden");
    }

    function toggleJoinBox() {
      const box = document.getElementById("joinBox");
      box.classList.toggle("hidden");
    }


    // åå‰è¨­å®š
    document.getElementById("setNameBtn").onclick = () => {
      const name = document.getElementById("nameInput").value.trim();
      if (name) socket.emit("setName", name);
    };

    // ãƒ«ãƒ¼ãƒ å‚åŠ 
    document.getElementById("joinBtn").onclick = () => {
      const roomId = document.getElementById("roomInput").value.trim();
      if (!roomId) return;
      if (roomId.includes("dgacha")) cardList = dgachaCardList;
      myRoomId = roomId;
      socket.emit("joinRoom", roomId);

      // æ¡ˆå†…æ–‡ã‚’éè¡¨ç¤ºã€ã‚²ãƒ¼ãƒ UIã‚’è¡¨ç¤º
      document.getElementById("intro").classList.add("hidden");
      document.getElementById("entered-room").classList.remove("hidden");
    };

    //ã‚¿ãƒ¼ãƒ³çµ‚äº†ç¢ºèª
    document.addEventListener("DOMContentLoaded", () => {
      const confirmBox = document.getElementById("confirmBox");
      const yesBtn = document.getElementById("yesBtn");
      const noBtn = document.getElementById("noBtn");
      const endBtn = document.getElementById("endTurnBtn");

      endBtn.onclick = () => {
        confirmBox.classList.remove("hidden");
      };

      yesBtn.onclick = () => {
        confirmBox.classList.add("hidden");
        if (myRoomId) socket.emit("endTurn", myRoomId);
        const msg = document.createElement("div");
        msg.textContent = "ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã—ã¾ã—ãŸã€‚";
        messagesDiv.appendChild(msg);
      };

      noBtn.onclick = () => {
        confirmBox.classList.add("hidden");
      };
    });


    //ã‚¿ãƒ¼ãƒ³çµ‚äº†
    /*document.getElementById("turnEnd").onclick = () => {
      const roomId = document.getElementById("roomInput").value.trim();
      if (!roomId) return;
      myRoomId = roomId;
      socket.emit("joinRoom", roomId);
    };*/

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
    socket.on("message", msg => {
      const div = document.createElement("div");
      div.textContent = msg;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    socket.on("playerMessage", msg => {
      const div = document.createElement("div");
      div.textContent = msg;
      messageWindowDiv.appendChild(div);
      messageWindowDiv.scrollTop = messageWindowDiv.scrollHeight;
    });

    socket.on("noCosts", () => {
      const div = document.createElement("div");
      div.textContent = "ã‚³ã‚¹ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼";
      messageWindowDiv.appendChild(div);
    });

    //ã‚³ã‚¹ãƒˆæ›´æ–°
    socket.on("updateCost", currentCost => {
      const costDiv = document.getElementById("costDiv");
      costDiv.innerHTML = `<h3>ã‚³ã‚¹ãƒˆï¼š${currentCost}/5</h3>`;
    });


    // HPæ›´æ–°
    socket.on("updateHP", (hp, names, effects) => {

      hpDiv.innerHTML = "";
      for (const id in hp) {
        const name = names[id] || id;

        // HPãƒãƒ¼ + åŠ¹æœã‚’æ¨ªä¸¦ã³
        const container = document.createElement("div");
        container.style.display = "flex";
        container.style.alignItems = "center";
        container.style.gap = "10px";
        container.style.marginBottom = "6px";

        // HPãƒãƒ¼
        const barBox = document.createElement("div");
        barBox.className = "hp-bar-container";

        const bar = document.createElement("div");
        bar.className = "hp-bar";
        const hpValue = Math.max(hp[id], 0);
        const maxHP = 20;
        bar.style.width = `${(hpValue / maxHP) * 100}%`;
        const text = document.createElement("span");
        barBox.textContent = `${name}: HP ${hpValue}`;
        barBox.appendChild(text);
        barBox.appendChild(bar);

        // åŠ¹æœãƒãƒƒã‚¸
        const effectBox = document.createElement("div");
        effectBox.style.display = "flex";
        effectBox.style.flexWrap = "wrap";
        effectBox.style.gap = "4px";

        if (effects && effects[id]) {
          effects[id].forEach(e => {
            if (e.remaining > 0) {
              const badge = document.createElement("span");
              badge.style.padding = "2px 6px";
              badge.style.borderRadius = "6px";
              badge.style.fontSize = "11px";
              badge.style.color = "white";

              switch (e.card.effect) {
                case "atkUp":
                  badge.textContent = `æ”»+${e.card.damageBoost}ï¼ˆ${e.remaining}ï¼‰`;
                  badge.style.background = "#e74c3c"; // èµ¤
                  break;
                case "atkMultiplier":
                  badge.textContent = `æ”»Ã—${e.card.multiplier}ï¼ˆ${e.remaining}ï¼‰`;
                  badge.style.background = "#c0392b"; // æ¿ƒèµ¤
                  break;
                case "shieldUp":
                  badge.textContent = `é˜²+${e.card.shieldBoost}ï¼ˆ${e.remaining}ï¼‰`;
                  badge.style.background = "#3498db"; // é’
                  break;
                case "shieldMultiplier":
                  badge.textContent = `é˜²Ã—${e.card.multiplier}ï¼ˆ${e.remaining}ï¼‰`;
                  badge.style.background = "#2980b9"; // æ¿ƒé’
                  break;
                case "avoidUp":
                  badge.textContent = `å›é¿ç‡+${e.card.avoid*100}%ï¼ˆ${e.remaining}ï¼‰`;
                  badge.style.background = "#a0d8ef"; // è–„é’
                  break;
                case "skipNextTurn":
                  //badge.textContent = "ã‚¹ã‚­ãƒƒãƒ—";
                  //badge.style.background = "#8e44ad"; // ç´«
                  break;
                case "multiTurn":
                  if (e.card.healPerTurn) {
                    badge.textContent = `å›å¾©+${e.card.healPerTurn}ï¼ˆ${e.remaining}ï¼‰`;
                    badge.style.background = "#27ae60"; // ç·‘
                  }
                  else if (e.card.shieldPerTurn) {
                    badge.textContent = `é˜²+${e.card.shieldPerTurn}ï¼ˆ${e.remaining}ï¼‰`;
                    badge.style.background = "#ADD8E6"; // è–„ã„é’
                  }
                  else if (e.card.damagePerTurn) {
                    badge.textContent = `æ”»+${e.card.damagePerTurn}ï¼ˆ${e.remaining}ï¼‰`;
                    badge.style.background = "#800080"; // ç´«
                  }
                  else {
                    div.textContent = "ã‚«ãƒ¼ãƒ‰åŠ¹æœæœªå®šç¾©ã‚¨ãƒ©ãƒ¼";
                  }
                  break;
                default:
                  badge.textContent = e.card.display_name || e.card.effect;
                  badge.style.background = "#7f8c8d"; // ã‚°ãƒ¬ãƒ¼
              }

              effectBox.appendChild(badge);
            }
          });
        }

        container.appendChild(barBox);
        container.appendChild(effectBox);
        hpDiv.appendChild(container);
      }
    });

    // ã‚¿ãƒ¼ãƒ³é–‹å§‹
    socket.on("yourTurn", (hand, hp, names) => {
      renderHand(hand);
      const div = document.createElement("div");
      div.textContent = "âœ¨ ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚";
      messageWindowDiv.appendChild(div);
    });

    // æ‰‹æœ­æ›´æ–°
    socket.on("updateHand", (hand) => {
      renderHand(hand);
    });

    // ã‚²ãƒ¼ãƒ çµ‚äº†
    socket.on("gameOver", winner => {
      alert(`ğŸ‰ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼å‹è€…: ${winner}`);
      handDiv.innerHTML = "";
    });

    // --- ã‚«ãƒ¼ãƒ‰ä½¿ç”¨æ™‚æ¼”å‡ºé–¢æ•° ---
    function showPlayedCard(cardName) {
      const container = document.getElementById("playedCardContainer");
      container.innerHTML = ""; // å‰ã®ã‚«ãƒ¼ãƒ‰æ¶ˆå»

      const img = document.createElement("img");
      img.src = `images/${cardName}.jpg`;
      img.alt = cardName;
      img.onerror = () => { img.src = "images/default.jpg"; };
      container.appendChild(img);

      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
      setTimeout(() => {
        img.style.opacity = "1";
        img.style.transform = "scale(1)";
      }, 50);

      // 1.5ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
      setTimeout(() => {
        img.style.opacity = "0";
        img.style.transform = "scale(0.8)";
      }, 1500);

      // 2ç§’å¾Œã«å®Œå…¨æ¶ˆå»
      setTimeout(() => {
        container.innerHTML = "";
      }, 2000);
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
    socket.on("notYourTurn", () => {
      const infoDiv = document.createElement("div");
      infoDiv.textContent = "ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã§ã™â€¦";
      messageWindowDiv.appendChild(infoDiv);
      messageWindowDiv.scrollTop = messagesDiv.scrollHeight;
      return;
    });

    // ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚«ãƒ¼ãƒ‰ä½¿ç”¨ã—ãŸã¨ã
    socket.on("cardPlayed", ({ playerName, cardName }) => {
      const msgDiv = document.createElement("div");

      // å¤§ããè¡¨ç¤º
      showPlayedCard(cardName);
    });

    // æ‰‹æœ­æç”»ï¼ˆç›¸æ‰‹ã‚¿ãƒ¼ãƒ³ã§ã‚‚å¸¸ã«è¦‹ãˆã‚‹ãƒ»æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã‚‚å³åæ˜ ï¼‰
    function renderHand(hand) {
      // ã„ã£ãŸã‚“å…¨å‰Šé™¤ã—ã¦å†æç”»
      handDiv.innerHTML = "";

      hand.forEach((card, i) => {
        const div = document.createElement("div");
        div.className = "card";
        div.style.position = "relative";
        div.style.opacity = "0";
        div.style.transform = "scale(0.9)";
        div.style.transition = "all 0.3s ease";

        // ã‚«ãƒ¼ãƒ‰ç”»åƒ
        const img = document.createElement("img");
        img.src = `images/${card.name}.jpg`;
        img.alt = card.name;
        img.onerror = () => { img.src = "images/default.jpg"; };
        div.appendChild(img);

        // ã‚«ãƒ¼ãƒ‰å
        const label = document.createElement("div");
        label.className = "card-label";
        label.textContent = card.display_name || card.name;
        div.appendChild(label);

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—èª¬æ˜æ–‡ã‚’ä½œæˆ
        let desc = `${label.textContent}`;
        if (card.damage) desc += ` æ”»æ’ƒ:${card.damage}`;
        if (card.heal) desc += ` å›å¾©:${card.heal}`;
        if (card.shield) desc += ` é˜²å¾¡:${card.shield}`;
        if (card.damagePerTurn) desc += ` æ”»æ’ƒ:${card.damagePerTurn}`;
        if (card.healPerTurn) desc += ` å›å¾©:${card.healPerTurn}`;
        if (card.shieldPerTurn) desc += ` é˜²å¾¡:${card.shieldPerTurn}`;
        if (card.effect) {
          switch (card.effect) {
            case "atkUp": desc += ` åŠ¹æœ:æ”»æ’ƒ+${card.damageBoost}`; break;
            case "atkMultiplier": desc += ` åŠ¹æœ:æ”»æ’ƒÃ—${card.multiplier}`; break;
            case "shieldUp": desc += ` åŠ¹æœ:é˜²å¾¡ã‚¢ãƒƒãƒ—${card.shieldBoost}`; break;
            case "shieldMultiplier": desc += ` åŠ¹æœ:é˜²å¾¡Ã—${card.multiplier}`; break;
            case "skipNextTurn": desc += " åŠ¹æœ:æ¬¡ã®ã‚¿ãƒ¼ãƒ³ã‚¹ã‚­ãƒƒãƒ—"; break;
            case "drawCard": desc += " åŠ¹æœ:ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã"; break;
            case "swapHand": desc += " åŠ¹æœ:æ‰‹æœ­ã‚’äº¤æ›"; break;
            case "multiTurn": desc += ` åŠ¹æœ:${card.turns}ã‚¿ãƒ¼ãƒ³æŒç¶š`; break;
          }
        }

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¦ç´ 
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.textContent = desc;
        div.appendChild(tooltip);

        // --- ã‚«ãƒ¼ãƒ‰ä½¿ç”¨æ™‚ ---
        div.onclick = () => {
          if (!myRoomId) return;

          if (!div.classList.contains("used")) {
            socket.emit("playCard", { roomId: myRoomId, cardName: card.name });

            // æ‰‹æœ­ã‚«ãƒ¼ãƒ‰ã‚’åŠé€æ˜ãƒ»æ“ä½œä¸å¯
            div.style.opacity = "0.5";
            div.style.pointerEvents = "none";
            div.classList.add("used");



            // å¤§ããè¡¨ç¤º
            //showPlayedCard(card.name);
          }

        };





        // --- ã‚¹ãƒãƒ›é•·æŠ¼ã—ã§ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º ---
        let pressTimer;
        div.addEventListener("touchstart", () => {
          pressTimer = setTimeout(() => {
            tooltip.style.visibility = "visible";
            tooltip.style.opacity = "1";
          }, 500); // 0.5ç§’é•·æŠ¼ã—ã§è¡¨ç¤º
        });

        div.addEventListener("touchend", () => {
          clearTimeout(pressTimer);
          tooltip.style.visibility = "hidden";
          tooltip.style.opacity = "0";
        });

        // ã‚«ãƒ¼ãƒ‰ã‚’æ‰‹æœ­ã«è¿½åŠ 
        handDiv.appendChild(div);

        // âœ… ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³æ¼”å‡ºï¼ˆé †ã«ãµã‚ã£ã¨è¡¨ç¤ºï¼‰
        setTimeout(() => {
          div.style.opacity = "1";
          div.style.transform = "scale(1)";
        }, 100 * i);
      });
    }

  </script>

  <!-- ğŸ§±ãƒ«ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div id="ruleModal" class="modal hidden">
    <div class="modal-content">
      <span class="close" onclick="closeRuleModal()">Ã—</span>
      <h2>ãƒ«ãƒ¼ãƒ«èª¬æ˜</h2>
      <p>
        ã“ã®ã‚²ãƒ¼ãƒ ã¯ã‚¿ãƒ¼ãƒ³åˆ¶ã‚«ãƒ¼ãƒ‰ãƒãƒˆãƒ«ã§ã™ã€‚<br><br>
        å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã‚«ãƒ¼ãƒ‰ã‚’1æšãšã¤é¸ã³ã€åŒæ™‚ã«å…¬é–‹ã—ã¾ã™ã€‚<br>
        æ”»æ’ƒã‚«ãƒ¼ãƒ‰ã¯ç›¸æ‰‹ã®HPã‚’æ¸›ã‚‰ã—ã€é˜²å¾¡ã‚«ãƒ¼ãƒ‰ã¯ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’è»½æ¸›ã—ã¾ã™ã€‚<br>
        å›å¾©ã‚«ãƒ¼ãƒ‰ã§HPã‚’å›å¾©ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚<br><br>
        HPãŒ0ã«ãªã£ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ•—åŒ—ã¨ãªã‚Šã¾ã™ã€‚<br>
        ç‰¹æ®Šã‚«ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦çŠ¶æ³ãŒå¤‰åŒ–ã™ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ï¼
      </p>
    </div>
  </div>

  <div id="confirmBox" class="hidden">
    <div class="confirm-content">
      <p>æœ¬å½“ã«ã‚¿ãƒ¼ãƒ³ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ</p>
      <button id="yesBtn">ã¯ã„</button>
      <button id="noBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </div>

  made by ChatGPT w/Alser

</body>

</html>
