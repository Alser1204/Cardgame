<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カードゲーム</title>
  <style>
    /* ページ全体のスタイル */
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #ece9e6, #ffffff); margin: 0; padding: 20px; text-align: center; }
    h1 { margin-bottom: 20px; color: #333; text-shadow: 1px 1px 2px #aaa; }
    input, button { padding: 10px; margin: 5px; border-radius: 8px; border: 1px solid #ccc; }
    button { background-color: #007bff; color: white; cursor: pointer; transition: background 0.3s; }
    button:hover { background-color: #0056b3; }

    /* プレイヤーの手札やメッセージエリア */
    #hand, #messages, #opponentHand, #hp, #opponentHp { margin: 20px auto; padding: 10px; border: 1px solid #ccc; border-radius: 8px; width: 80%; background: white; }
    .card { display: inline-block; margin: 5px; padding: 10px; border: 1px solid #aaa; border-radius: 8px; width: 120px; background: #f9f9f9; cursor: pointer; transition: transform 0.2s; position: relative; }
    .card:hover { transform: scale(1.05); background: #eef; }
    .tooltip { display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 5px; border-radius: 5px; font-size: 12px; white-space: pre-line; z-index: 10; }
    .card:hover .tooltip { display: block; }
  </style>
</head>
<body>
  <h1>リアルタイムカードゲーム</h1>

  <!-- 名前とルームを入力 -->
  <input id="nameInput" placeholder="名前を入力">
  <input id="roomInput" placeholder="ルーム名を入力">
  <button onclick="setName()">名前を設定</button>
  <button onclick="joinRoom()">ルームに参加</button>

  <!-- 各表示領域 -->
  <div id="messages"></div>       <!-- サーバーからのメッセージ表示 -->
  <div id="opponentHand">相手の手札</div>
  <div id="hand">自分の手札</div>
  <div id="hp">自分のHP</div>
  <div id="opponentHp">相手のHP</div>

  <!-- Socket.IO クライアントライブラリを読み込み -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // サーバーと接続
    const socket = io();
    let playerName = "";
    let hand = [];
    let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    /** 📌 サーバーからメッセージを受け取ったら表示する */
    socket.on("message", (msg) => {
      const div = document.createElement("div");
      div.textContent = msg;
      document.getElementById("messages").appendChild(div);
    });

    /** 📌 名前をサーバーに送信 */
    function setName() {
      playerName = document.getElementById("nameInput").value;
      socket.emit("setName", playerName);
    }

    /** 📌 ルーム参加リクエストを送信 */
    function joinRoom() {
      const room = document.getElementById("roomInput").value;
      socket.emit("joinRoom", room);
    }

    /** 📌 自分の手札を画面に描画する */
    function renderHand(cards) {
      const handDiv = document.getElementById("hand");
      handDiv.innerHTML = "";
      cards.forEach((card, index) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "card";
        cardDiv.textContent = card.name;

        // ツールチップ（カード詳細説明）
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.textContent = `攻撃力: ${card.damage || 0}\n効果: ${card.effect || "なし"}`;
        cardDiv.appendChild(tooltip);

        // PC: hover で説明, クリックでカードを使う
        // スマホ: 長押しで説明, タップでカードを使う
        if (isMobile) {
          let pressTimer;
          cardDiv.addEventListener("touchstart", (e) => {
            pressTimer = setTimeout(() => tooltip.style.display = "block", 500);
          });
          cardDiv.addEventListener("touchend", (e) => {
            clearTimeout(pressTimer);
            if (tooltip.style.display === "block") tooltip.style.display = "none";
            else playCard(index); // 長押しじゃなければカードを出す
          });
        } else {
          cardDiv.onclick = () => playCard(index);
        }
        handDiv.appendChild(cardDiv);
      });
    }

    /** 📌 カードをサーバーに送信 */
    function playCard(index) {
      socket.emit("playCard", index);
    }

    /** 📌 自分のターンになった時、手札を更新 */
    socket.on("yourTurn", (cards) => {
      hand = cards;
      renderHand(hand);
    });

    /** 📌 HP表示を更新 */
    socket.on("updateHP", (hpData) => {
      const hpDiv = document.getElementById("hp");
      const opponentHpDiv = document.getElementById("opponentHp");
      hpDiv.innerHTML = ""; opponentHpDiv.innerHTML = "";
      // 自分のHPバー
      for (let i = 0; i < hpData.player; i++) {
        const hpBlock = document.createElement("span");
        hpBlock.textContent = "❤️";
        hpDiv.appendChild(hpBlock);
      }
      // 相手のHPバー
      for (let i = 0; i < hpData.opponent; i++) {
        const hpBlock = document.createElement("span");
        hpBlock.textContent = "❤️";
        opponentHpDiv.appendChild(hpBlock);
      }
    });

    /** 📌 相手の手札を更新 */
    socket.on("updateOpponentHand", (count) => {
      const opponentHandDiv = document.getElementById("opponentHand");
      opponentHandDiv.innerHTML = "相手の手札: ";
      for (let i = 0; i < count; i++) {
        const cardBack = document.createElement("span");
        cardBack.textContent = "[カード]";
        opponentHandDiv.appendChild(cardBack);
      }
    });
  </script>
</body>
</html>
