<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </title>
  <style>
    /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #ece9e6, #ffffff); margin: 0; padding: 20px; text-align: center; }
    h1 { margin-bottom: 20px; color: #333; text-shadow: 1px 1px 2px #aaa; }
    input, button { padding: 10px; margin: 5px; border-radius: 8px; border: 1px solid #ccc; }
    button { background-color: #007bff; color: white; cursor: pointer; transition: background 0.3s; }
    button:hover { background-color: #0056b3; }

    /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ã‚„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */
    #hand, #messages, #opponentHand, #hp, #opponentHp { margin: 20px auto; padding: 10px; border: 1px solid #ccc; border-radius: 8px; width: 80%; background: white; }
    .card { display: inline-block; margin: 5px; padding: 10px; border: 1px solid #aaa; border-radius: 8px; width: 120px; background: #f9f9f9; cursor: pointer; transition: transform 0.2s; position: relative; }
    .card:hover { transform: scale(1.05); background: #eef; }
    .tooltip { display: none; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 5px; border-radius: 5px; font-size: 12px; white-space: pre-line; z-index: 10; }
    .card:hover .tooltip { display: block; }
  </style>
</head>
<body>
  <h1>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </h1>

  <!-- åå‰ã¨ãƒ«ãƒ¼ãƒ ã‚’å…¥åŠ› -->
  <input id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›">
  <input id="roomInput" placeholder="ãƒ«ãƒ¼ãƒ åã‚’å…¥åŠ›">
  <button onclick="setName()">åå‰ã‚’è¨­å®š</button>
  <button onclick="joinRoom()">ãƒ«ãƒ¼ãƒ ã«å‚åŠ </button>

  <!-- å„è¡¨ç¤ºé ˜åŸŸ -->
  <div id="messages"></div>       <!-- ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
  <div id="opponentHand">ç›¸æ‰‹ã®æ‰‹æœ­</div>
  <div id="hand">è‡ªåˆ†ã®æ‰‹æœ­</div>
  <div id="hp">è‡ªåˆ†ã®HP</div>
  <div id="opponentHp">ç›¸æ‰‹ã®HP</div>

  <!-- Socket.IO ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿ -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // ã‚µãƒ¼ãƒãƒ¼ã¨æ¥ç¶š
    const socket = io();
    let playerName = "";
    let hand = [];
    let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    /** ğŸ“Œ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã£ãŸã‚‰è¡¨ç¤ºã™ã‚‹ */
    socket.on("message", (msg) => {
      const div = document.createElement("div");
      div.textContent = msg;
      document.getElementById("messages").appendChild(div);
    });

    /** ğŸ“Œ åå‰ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ */
    function setName() {
      playerName = document.getElementById("nameInput").value;
      socket.emit("setName", playerName);
    }

    /** ğŸ“Œ ãƒ«ãƒ¼ãƒ å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ */
    function joinRoom() {
      const room = document.getElementById("roomInput").value;
      socket.emit("joinRoom", room);
    }

    /** ğŸ“Œ è‡ªåˆ†ã®æ‰‹æœ­ã‚’ç”»é¢ã«æç”»ã™ã‚‹ */
    function renderHand(cards) {
      const handDiv = document.getElementById("hand");
      handDiv.innerHTML = "";
      cards.forEach((card, index) => {
        const cardDiv = document.createElement("div");
        cardDiv.className = "card";
        cardDiv.textContent = card.name;

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆã‚«ãƒ¼ãƒ‰è©³ç´°èª¬æ˜ï¼‰
        const tooltip = document.createElement("div");
        tooltip.className = "tooltip";
        tooltip.textContent = `æ”»æ’ƒåŠ›: ${card.damage || 0}\nåŠ¹æœ: ${card.effect || "ãªã—"}`;
        cardDiv.appendChild(tooltip);

        // PC: hover ã§èª¬æ˜, ã‚¯ãƒªãƒƒã‚¯ã§ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ã†
        // ã‚¹ãƒãƒ›: é•·æŠ¼ã—ã§èª¬æ˜, ã‚¿ãƒƒãƒ—ã§ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ã†
        if (isMobile) {
          let pressTimer;
          cardDiv.addEventListener("touchstart", (e) => {
            pressTimer = setTimeout(() => tooltip.style.display = "block", 500);
          });
          cardDiv.addEventListener("touchend", (e) => {
            clearTimeout(pressTimer);
            if (tooltip.style.display === "block") tooltip.style.display = "none";
            else playCard(index); // é•·æŠ¼ã—ã˜ã‚ƒãªã‘ã‚Œã°ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™
          });
        } else {
          cardDiv.onclick = () => playCard(index);
        }
        handDiv.appendChild(cardDiv);
      });
    }

    /** ğŸ“Œ ã‚«ãƒ¼ãƒ‰ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ */
    function playCard(index) {
      socket.emit("playCard", index);
    }

    /** ğŸ“Œ è‡ªåˆ†ã®ã‚¿ãƒ¼ãƒ³ã«ãªã£ãŸæ™‚ã€æ‰‹æœ­ã‚’æ›´æ–° */
    socket.on("yourTurn", (cards) => {
      hand = cards;
      renderHand(hand);
    });

    /** ğŸ“Œ HPè¡¨ç¤ºã‚’æ›´æ–° */
    socket.on("updateHP", (hpData) => {
      const hpDiv = document.getElementById("hp");
      const opponentHpDiv = document.getElementById("opponentHp");
      hpDiv.innerHTML = ""; opponentHpDiv.innerHTML = "";
      // è‡ªåˆ†ã®HPãƒãƒ¼
      for (let i = 0; i < hpData.player; i++) {
        const hpBlock = document.createElement("span");
        hpBlock.textContent = "â¤ï¸";
        hpDiv.appendChild(hpBlock);
      }
      // ç›¸æ‰‹ã®HPãƒãƒ¼
      for (let i = 0; i < hpData.opponent; i++) {
        const hpBlock = document.createElement("span");
        hpBlock.textContent = "â¤ï¸";
        opponentHpDiv.appendChild(hpBlock);
      }
    });

    /** ğŸ“Œ ç›¸æ‰‹ã®æ‰‹æœ­ã‚’æ›´æ–° */
    socket.on("updateOpponentHand", (count) => {
      const opponentHandDiv = document.getElementById("opponentHand");
      opponentHandDiv.innerHTML = "ç›¸æ‰‹ã®æ‰‹æœ­: ";
      for (let i = 0; i < count; i++) {
        const cardBack = document.createElement("span");
        cardBack.textContent = "[ã‚«ãƒ¼ãƒ‰]";
        opponentHandDiv.appendChild(cardBack);
      }
    });
  </script>
</body>
</html>
